# 目标

输入：帧间小地图的匹配，以及当前帧与大地图的匹配


输出：大地图坐标下的offset两帧坐标原点的偏移量

# 分析

首先定义三个坐标系: $C_A$、 $C_B$、 $C_W$，分别表示上一帧、当前帧、大地图的坐标系。

为了简化，可以假设一组三个坐标系均匹配的特征点集 $\{P_i\}$，即点集中的点不变，发生变化的为
两帧坐标系在大世界坐标系下的位置和姿态。

易知， $^W\{P_i\}$，即大世界坐标下的点集的坐标到 $C_A$、 $C_B$坐标系下的坐标的变换矩阵形式为仅存在缩放和平移变换的仿射变换矩阵，即变换矩阵的形式为

```math
\begin{bmatrix}
s & 0 & t_x \\
0 & s & t_y \\
0 & 0 & 1
\end{bmatrix}
```
注意到连乘多个变换矩阵可以合并为一个变换矩阵，形式不变（物理意义：自由度根本没变）。

假设：对于两个小地图的坐标，使用角色位置为原点的坐标系，即 $C_A$、 $C_B$坐标系的原点分别为两帧的角色位置。

于是，输出使用数学描述为： $^W\{^AP_{0,0}\}$ - $^W\{^BP_{0,0}\}$

# 求解

上一节得到的： $^W\{^AP_{0,0}\}$ -  $^W\{^BP_{0,0}\}$

=  $^W_AT \cdot ^AP_{0,0}$ -  $^W_BT \cdot ^BP_{0,0}$

=  $^W_AT \cdot [0,0,1]$ -  $^W_BT  \cdot [0,0,1]$

需要维护上一帧的 $^W_AT$和当前帧的 $^W_BT$，即可求解。

而这两个变换矩阵可以通过两帧的匹配通过求解线性方程组得到。
